require "sinatra/activerecord/rake"
require "./app"

task default: %w[test:test_app]

namespace :assets do
    desc "download assets"
    task :download do
        `rm -rf assets/tmp`
        `rm -rf assets/fonts`
        `mkdir -p assets/tmp`
        `mkdir -p assets/fonts`
        
        #JS
        `wget -O assets/tmp/100_jquery.js https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.js`
        `wget -O assets/tmp/200_bootstrap.js https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.js`
        
        #CSS
        `wget -O assets/tmp/100_bootstrap.css https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/css/bootstrap.min.css`

        #FONTS
        `wget -O assets/fonts/glyphicons-halflings-regular.eot https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/fonts/glyphicons-halflings-regular.eot`
        `wget -O assets/fonts/glyphicons-halflings-regular.svg https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/fonts/glyphicons-halflings-regular.svg`
        `wget -O assets/fonts/glyphicons-halflings-regular.ttf https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/fonts/glyphicons-halflings-regular.ttf`
        `wget -O assets/fonts/glyphicons-halflings-regular.woff https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/fonts/glyphicons-halflings-regular.woff`
        `wget -O assets/fonts/glyphicons-halflings-regular.woff2 https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/fonts/glyphicons-halflings-regular.woff2`

    end

    desc "generate assets"
    task :generate do
        `rm -rf public`
        `mkdir -p public`
        
        `cat assets/tmp/*.css > public/theme.css`
        `cat assets/tmp/*.js > public/script.js`

        `cat assets/css/*.css >> public/theme.css`
        `cat assets/js/*.js >> public/script.js`
        `cp -r assets/img public/`
        `cp -r assets/fonts public/`
    end
end

namespace :server do
  desc "Install server dependencies"
  task :install do
    `gem install bundler`
    `bundle install --jobs=3 --retry=3 --deployment`
  end

  desc "Launch web server"
  task :run do
    `rackup`
  end
end

namespace :test do
    desc "Unit tests"
    task :test_app do
        ruby "test/app_test.rb"
    end
end

